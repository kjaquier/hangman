<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns='http://www.w3.org/1999/xhtml'><head><title>Unit 2</title> 
    <meta name='copyright' content='Copyright ⓒ 2013 Cay S. Horstmann'/> 
    <meta content='text/html; charset=UTF-8' http-equiv='content-type'/> 
    <link type='text/css' rel='stylesheet' media='screen, projection, print' href='../../../Slidy2/styles/slidy.css'/> 
    <link type='text/css' rel='stylesheet' media='screen, projection, print' href='../../../MySlidy/style.css'/> 
    <style type='text/css'>div.slide { background-image: url("../../images/sjsu_logo.gif"); background-position: top right; background-repeat: no-repeat; }</style> 
    <script src='../../../Slidy2/scripts/slidy.js' charset='utf-8' type='text/javascript'></script>
    <script src='../../../MySlidy/slidy.js' charset='utf-8' type='text/javascript'></script> </head> 
  <body><h1>Mobile Programming - Unit 2</h1>
    <p class='fullimage'><img src='../../images/tower-hall.jpg' alt='Cover page image'/></p> 
    <p><a href='http://horstmann.com/'>Cay S. Horstmann</a></p> 
    <h1>Layouts</h1>
		<ul><li>Java Swing: Programmatic (e.g. <code>GridBagLayout</code>)</li>
			<li>HTML: Declarative</li>
			<li>Visual Basic: Drag and Drop</li>
			<li>Android: All of the above</li>
			<li>Easiest approach: Start with Drag and Drop</li>
			<li>Essential to look at the XML</li>
			<li>For now, just use <code>RelativeLayout</code></li>
			<li>Pay attention to <code>android:layout_below</code>, <code>android:layout_toRightOf</code></li>
    </ul>
 
    <h1>IDs</h1>
		<ul><li>Can specify <code>TextView</code> strings declaratively.</li>
			<li>Either with <code>android:text="Fred"</code> or with <code>android:text="@string/main_character_name"</code></li>
			<li>Won't work when we need to update text dynamically.</li>
			<li>Assign an ID to each component</li>
			<li>Right-click in GUI builder</li>
			<li>In XML, set <code>android:id="@+id/questionText"</code></li>
			<li>Get ID as <code>R.id.questionText</code> in Java code
<pre>TextView t = (TextView) findViewById(R.id.questionText);
t.setText("How old is Fred?");
</pre></li>
    </ul>

		<h1>AsyncTask</h1>
		<ul><li>UI activities occur in UI thread</li>
			<li>Your app is called whenever something interesting happens (startup, button press, etc.)</li>
			<li>When it's your turn, do your thing quickly and return from callback</li>
			<li>If you do something time-consuming (e.g. read data from the web), your app (and maybe the phone) could freeze.</li>
			<li>Android suspends apps with unresponsive UI</li>
			<li>Android won't let you do I/O on the UI thread</li>
			<li>Do time-consuming work on a background thread</li>
			<li><code>AsyncTask</code> convenience class makes this easy.</li>
    </ul>
			
		<h1>AsyncTask</h1>
		<ul><li><pre>class DownloadTextTask extends AsyncTask&lt;URL, Void, String&gt; {
     protected String doInBackground(URL... urls) {
         Scanner in = new Scanner(urls[0].openStream());
         StringBuilder result = new StringBuilder();
         while (in.hasNext()) { result.append(in.next()); result.append("\n"); }
         return result.toString();
     }

     protected void onPostExecute(String result) {
         view.setText(result);
     }
 }</pre></li>
      <li>Start with
<pre>new DownloadTextTask().execute(new URL("http://example.com/fred.txt"));
</pre></li>      
			<li>Makes a new thread that runs <code>doInBackground</code></li>
			<li>When that thread is completed, calls <code>onPostExecute</code> on the UI thread</li>
      <li>First type parameter is for launch arguments (using varargs)</li>
			<li>Second type parameter is for progress reports (not covered now)</li>
			<li>Third type parameter is result type</li>
    </ul>

    <h1>LogCat</h1>
		<ul><li>Remember—no <code>System.out</code></li>
			<li>Log manager collects, presents logging messages</li>
			<li>Can see LogCat output in Eclipse</li>
			<li>Can attach device to USB and get logs</li>
			<li>Lots of apps to inspect the logs on a device, e.g. <a href='https://play.google.com/store/apps/details?id=com.nolanlawson.logcat&hl=en'>CatLog</a></li>
			<li>API makes it as easy as possible:
<pre><strong>Log.e</strong>(getClass().toString(), exception.getMessage());
</pre></li>
			<li><code>Log.d</code> for debug, <code>Log.w</code> for warnings etc.</li>
			<li>First parameter is tag (for filtering), second is message text</li>
			<li>This view is very cramped; makes sense to detach.</li>
    </ul>			 
		<h1>Permissions</h1>
		<ul><li>Any app can put up buttons, images, etc. on the screen</li>
			<li>Everything that might cost the user money or compromise their privacy requires permission</li>
			<li>Permissions displayed to user at install time</li>
			<li>Permissions must be entered in app manifest</li>
			<li>To read data from internet, need <code>android.permission.INTERNET</code></li>
			<li>Can set in Eclipse—choose Use Permission button and select permission from menu</li>
			<li>Or edit XML file and add 
<pre>&lt;uses-permission android:name="android.permission.INTERNET"/&gt;
</pre></li>
      </ul>

    <h1>Lab</h1> 
    <p class='sideimage'><img src='../../images/lab.jpg'/></p> 
    <ul><li>Bring your laptop to each class</li> 
      <li>You will work with a buddy</li> 
      <li>One of you writes code, the other types up answers</li> 
      <li>Switch roles each lab (not each day)</li> 
      <li>Submit lab work to Piazza</li> 
    </ul>

    <h1>Quiz Question</h1> 
		<p>Goal: Android application that displays a quiz question, like this:</p>
		<p><img src='hw01.png'/></p>
    <h1>Layout</h1>
		<ol><li>Make a new project with application and project name <code>unit2</code> in the package <code>edu.sjsu.cs175.unit2</code>.</li>
			<li>Using the graphical layout builder, set up the question text and four answers. Make your own question, not the one in <code>question.txt</code>. Make sure each element has an ID. How did you do this?</li>
			<li>When I did this, I got XML with messy alignment. I wanted the buttons below each other, and each option to the right of its button, aligned on the baseline. I had to fix up a couple of them, and it's pretty likely you will need to do the same. Explain the changes that you made.</li>
			<li>Why did you get warning triangles next to each text view? (You don't need to fix them now.)</li>
			<li>Run your application. What happens?</li>
      </ol>
      <h1>Programmatic Strings</h1>
     <ul><li>Now let's set the strings programmatically, not with the UI builder. Add code to set each textfield so that a different question and different options are displayed. How did you do this?</li>
			<li>Now let's read the question and four answer options from the web, specifically from <a href='question.txt'>here</a>. 
Here is the code for reading the contents of a web page into a list, a line at a time:
<pre>                ArrayList&lt;String&gt; result = new ArrayList&lt;String&gt;();                
                try {
                    <strong>URL url = new URL(urlString);</strong>
                    Scanner in = new Scanner(url.openStream());
                    while (in.hasNextLine()) 
                        <strong>result.add(in.nextLine());</strong>
                in.close();
                } catch (IOException e) {
                    <strong>Log.e(getClass().toString(), e.getMessage());</strong>
                }</pre>
					Place this code in your <code>onCreate</code> method, and then set each <code>TextView</code> to <code>results.get(0)</code>, <code>results.get(1)</code>, and so on. What happens when you run your program?</li>
      <li>Look in the LogCat output. What error message do you see that is related to the problem?</li>
			<li>Do you see any output that could have come from the <code>Log.e</code> call? How do you know for sure?</li>
			<li>Put breakpoints in the three red lines above. Run the debugger. The first breakpoint will hit. Then click on Continue in the debugger. Which of the breakpoints get hit next?</li>
			<li>What do you conclude from these observations?</li>
			<li>Use an <code>AsyncTask</code> to solve this problem. How did you do this?</li>
    </ul>
  </body>
</html>
